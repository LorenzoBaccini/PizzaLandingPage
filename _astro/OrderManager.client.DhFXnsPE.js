import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as l}from"./index.Cd_vQiNd.js";import{e as y,f as t}from"./index.95d291e9.S0cFX4FE.js";function A({onClick:r,totalItems:o}){const[d,h]=l.useState(!1);return l.useEffect(()=>{if(o>0){h(!0);const N=setTimeout(()=>h(!1),500);return()=>clearTimeout(N)}},[o]),e.jsx("div",{className:y.orderBadge,onClick:r,children:e.jsxs("button",{className:y.orderBadgeButton,children:[e.jsx("span",{children:"🛒 Il Mio Ordine"}),e.jsx("span",{className:`${y.badgeCounter} ${d?y.animate:""}`,children:o})]})})}const p={phoneNumber:"0362 197 2430",whatsappNumber:"393338007658",maxQuantityPerItem:20,toastDuration:3e3};function F({isOpen:r,onClose:o,items:d,onUpdateQuantity:h,onRemoveItem:N,onClearOrder:j,note:x,onUpdateNote:g}){const[C,v]=l.useState(!1),[S,n]=l.useState(""),[i,c]=l.useState(""),[w,m]=l.useState(!1),b=l.useRef(!1);l.useEffect(()=>{if(r&&!b.current){window.history.pushState({mioOrdineOpen:!0},""),b.current=!0;const a=s=>{b.current&&o()};return window.addEventListener("popstate",a),()=>{window.removeEventListener("popstate",a),b.current=!1}}},[r,o]);const E=()=>m(!0);l.useEffect(()=>{if(r){document.body.style.overflow="hidden";const a=s=>{s.key==="Escape"&&o()};return document.addEventListener("keydown",a),()=>{document.body.style.overflow="unset",document.removeEventListener("keydown",a)}}},[r,o]);const z=()=>d.reduce((a,s)=>{const u=typeof s.prezzo=="number"?s.prezzo:parseFloat(s.prezzo)||0;return a+u*s.quantita},0),I=()=>{let a=`🍕 IL MIO ORDINE

`;return d.forEach(s=>{const u=typeof s.prezzo=="number"?s.prezzo:parseFloat(s.prezzo)||0;a+=`${s.quantita}x ${s.nome} - €${(u*s.quantita).toFixed(2)}
`}),a+=`
Totale: €${z().toFixed(2)}`,a+=`
Ricorda la consegna:
- A Desio: €1,00
- Fuori Desio: €2,00`,x.trim()&&(a+=`

Note: ${x}`),a},f=(a,s="")=>{n(a),c(s),v(!0),setTimeout(()=>v(!1),p.toastDuration)},O=()=>{/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)?(window.location.href=`tel:${p.phoneNumber}`,f("💡 Tieni aperta questa lista mentre ordini","success")):navigator.clipboard.writeText(p.phoneNumber).then(()=>{f(`📞 Numero copiato! ${p.phoneNumber}`,"success")}).catch(()=>{alert("Numero di telefono: "+p.phoneNumber)})},$=()=>{const a=encodeURIComponent(I()),s=`https://wa.me/${p.whatsappNumber}?text=${a}`;window.open(s,"_blank")},k=()=>{const a=I();navigator.clipboard&&window.isSecureContext?navigator.clipboard.writeText(a).then(()=>{f("📋 Lista copiata negli appunti!","success")}).catch(()=>{s()}):s();function s(){try{const u=document.createElement("textarea");u.value=a,u.setAttribute("readonly",""),u.style.position="absolute",u.style.left="-9999px",document.body.appendChild(u),u.select(),document.execCommand("copy"),document.body.removeChild(u),f("📋 Lista copiata negli appunti!","success")}catch{f("Copia non supportata su questo dispositivo","error")}}},q=()=>{m(!1),j(),f("Lista svuotata")},P=()=>m(!1);return r?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:t.orderOverlay,onClick:o}),e.jsxs("div",{className:`${t.orderPanel} ${r?t.active:""}`,children:[e.jsxs("div",{className:t.orderPanelHeader,children:[e.jsxs("h2",{children:["Il Mio Ordine (",d.reduce((a,s)=>a+s.quantita,0),")"]}),e.jsx("button",{className:t.btnClosePanel,onClick:o,"aria-label":"Chiudi pannello",children:"×"})]}),e.jsx("div",{className:t.orderPanelContent,children:d.length===0?e.jsxs("div",{className:t.emptyState,children:[e.jsx("div",{className:t.emptyStateIcon,children:"📝"}),e.jsx("p",{className:t.emptyStateText,children:"La tua lista è vuota. Inizia ad aggiungere i tuoi prodotti preferiti!"}),e.jsx("button",{className:t.btnPrimary,onClick:o,children:"Vai al Menu"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:t.orderItemsList,children:d.map(a=>{const s=typeof a.prezzo=="number"?a.prezzo:parseFloat(a.prezzo)||0;return e.jsxs("div",{className:t.orderItem,children:[e.jsxs("div",{className:t.orderItemInfo,children:[e.jsx("div",{className:t.orderItemName,children:a.nome}),e.jsxs("div",{className:t.orderItemPrice,children:["€",s.toFixed(2)," cad."]})]}),e.jsxs("div",{className:t.orderItemControls,children:[e.jsxs("div",{className:t.orderItemSubtotal,children:["€",(s*a.quantita).toFixed(2)]}),e.jsxs("div",{className:t.quantitySelector,children:[e.jsx("button",{onClick:()=>h(a.id,a.quantita-1),children:"−"}),e.jsx("span",{className:t.quantity,children:a.quantita}),e.jsx("button",{onClick:()=>h(a.id,a.quantita+1),disabled:a.quantita>=p.maxQuantityPerItem,children:"+"})]}),e.jsx("button",{className:t.btnRemoveItem,onClick:()=>N(a.id),children:"Rimuovi"})]})]},a.id)})}),e.jsxs("div",{className:t.orderNotes,children:[e.jsx("label",{htmlFor:"orderNotes",children:"Note aggiuntive (opzionale)"}),e.jsx("textarea",{id:"orderNotes",placeholder:"Es: Senza cipolle, extra piccante...",value:x,onChange:a=>g(a.target.value)})]}),e.jsx("div",{className:t.orderTotal,children:e.jsxs("div",{className:t.orderTotalRow,children:[e.jsx("span",{children:"Totale:"}),e.jsxs("span",{className:t.orderTotalAmount,children:["€",z().toFixed(2)]}),e.jsxs("div",{className:t.orderDeliveryInfo,children:[e.jsx("span",{children:"Consegna (da aggiungere al totale):"}),e.jsx("br",{}),e.jsxs("span",{children:["A Desio: ",e.jsx("span",{className:t.orderDeliveryAmount,children:"€1,00"})]}),e.jsx("br",{}),e.jsxs("span",{children:["Fuori Desio: ",e.jsx("span",{className:t.orderDeliveryAmount,children:"€2,00"})]})]})]})}),e.jsxs("div",{className:t.orderActions,children:[e.jsx("button",{className:t.btnPrimary,onClick:O,children:"📞 Chiama per Ordinare"}),e.jsx("button",{className:`${t.btnSecondary} ${t.btnWhatsapp}`,onClick:$,children:"💬 Condividi via WhatsApp"}),e.jsx("button",{className:t.btnSecondary,onClick:k,children:"📋 Copia Lista"}),e.jsx("button",{className:t.btnClear,onClick:E,children:"Svuota Lista"}),w&&e.jsx("div",{className:t.confirmModalOverlay,tabIndex:-1,role:"dialog","aria-modal":"true",children:e.jsx("div",{className:t.confirmModal,children:e.jsxs("div",{className:t.confirmModalContent,children:[e.jsx("h3",{children:"Sei sicuro di voler svuotare la lista?"}),e.jsxs("div",{className:t.confirmModalActions,children:[e.jsx("button",{className:t.btnSecondary,onClick:P,children:"Annulla"}),e.jsx("button",{className:t.btnPrimary,onClick:q,children:"Svuota"})]})]})})})]})]})})]}),C&&e.jsx("div",{className:`${t.toast} ${t.show} ${i==="success"?t.success:""}`,children:S})]}):null}const T="pizzeria_mio_ordine";function R(){const[r,o]=l.useState([]),[d,h]=l.useState(""),[N,j]=l.useState(!1);l.useEffect(()=>{try{const n=localStorage.getItem(T);if(n){const i=JSON.parse(n);o(i.items||[]),h(i.note||"")}}catch(n){console.error("Error loading order:",n)}},[]),l.useEffect(()=>{const n={items:r,note:d,timestamp:Date.now()};localStorage.setItem(T,JSON.stringify(n))},[r,d]);const x=(n,i)=>{i<=0?o(r.filter(c=>c.id!==n)):o(r.map(c=>c.id===n?{...c,quantita:Math.min(i,20)}:c))},g=n=>{o(r.filter(i=>i.id!==n))},C=()=>{o([]),h("")},v=n=>{h(n)},S=r.reduce((n,i)=>n+i.quantita,0);return l.useEffect(()=>{window.orderManager={addItem:(n,i=1)=>{o(c=>c.find(m=>m.id===n.id)?c.map(m=>m.id===n.id?{...m,quantita:Math.min(m.quantita+i,20)}:m):[...c,{id:n.id,nome:n.nome,prezzo:n.prezzo,quantita:i}])},getItemQuantity:n=>{const i=r.find(c=>c.id===n);return i?i.quantita:0},updateQuantity:x}},[r]),e.jsxs(e.Fragment,{children:[e.jsx(A,{onClick:()=>j(!0),totalItems:S}),e.jsx(F,{isOpen:N,onClose:()=>j(!1),items:r,onUpdateQuantity:x,onRemoveItem:g,onClearOrder:C,note:d,onUpdateNote:v})]})}export{R as default};
